<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="/portfolio/_next/static/css/28e8d7af1365f61e.css" data-precedence="next"/>
  <link rel="stylesheet" href="/portfolio/_next/static/css/028b338515cb152f.css" data-precedence="next"/>
  <link rel="icon" href="/portfolio/favicon.ico" type="image/x-icon" sizes="16x16"/>
</head>
<body class="__variable_6d341e __variable_6d341e antialiased">
<header class="sticky top-0 z-50 backdrop-blur bg-background/70 border-b border-foreground/10"><div class="max-w-6xl mx-auto px-4 sm:px-6 h-14 flex items-center justify-between"><a class="text-sm font-semibold tracking-tight" href="/portfolio/">한승범</a><nav class="flex items-center gap-3"><a href="https://www.linkedin.com/in/%EC%8A%B9%EB%B2%94-%ED%95%9C-54984b168" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-foreground/15 hover:bg-foreground/5 text-sm"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1 4.98 2.12 4.98 3.5zM.5 8h4V24h-4V8zm7 0h3.8v2.2h.06c.53-1 1.83-2.2 3.76-2.2 4.02 0 4.76 2.64 4.76 6.07V24h-4v-7.1c0-1.69-.03-3.86-2.35-3.86-2.35 0-2.71 1.83-2.71 3.73V24h-4V8z"></path></svg>LinkedIn</a><a href="mailto:beoms6000@gmail.com" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-foreground/15 hover:bg-foreground/5 text-sm"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 13.065 1.5 6h21L12 13.065zM12 15 1.5 8v10h21V8L12 15z"></path></svg>Email</a></nav></div></header>
<div class="max-w-5xl mx-auto px-6 py-10 space-y-8">
  <header class="space-y-3">
    <h1 class="text-2xl sm:text-4xl font-bold tracking-tight">회차목록 개편 &gt; 프리뷰탭 신설</h1>
  </header>
  <article class="markdown-body max-w-[68ch] mx-auto text-foreground/90"><p><strong>프리뷰탭 신설</strong>이라는 과제를 맡게 되었습니다.</p>
<p><img src="/portfolio/projects/episode-list-preview-tab/before.png" alt="Before">
<img src="/portfolio/projects/episode-list-preview-tab/after.png" alt="After"></p>
<ul>
<li>왼쪽 <strong>회차목록 화면</strong>을 오른쪽처럼 [<strong>프리뷰탭 | 회차목록</strong>] 탭 구성의 UI로 전환하는 작업입니다.</li>
<li>탭만 추가하고 Fragment만 붙여주면 될 것 같지만, 실상은 그렇지 않았습니다.</li>
<li>회차목록 쪽 코드는 굉장히 오래된 코드입니다.
<ul>
<li>MVI 구조로 구현이 되었으나, 수정이 여러번 되어 코드의 흐름을 따라가기 어려운 상황이고, 기능추가가 쉽지 않았습니다.</li>
<li>결제, 회차목록 동기화, BM정보로드 에러등 수많은 에러케이스가 엮여 있습니다</li>
<li>모듈화가 되어 있지 않아서 data model을 ui에서 직접 사용하는 등 개선이 필요합니다.</li>
</ul>
</li>
<li>현 구조서 기능만 추가할 지, 아예 구조를 수정하고 기능을 추가할 지 팀원간 긴 시간 논의를 하였습니다.
<ul>
<li>이번 기회가 아니면 이쪽 구조는 개선할 기회가 없다는 사실에 팀원 모두 동의하였습니다.</li>
<li>저희는 결국 험난한 길(?)을 가기로 결정하였습니다.
<ul>
<li>app 모듈에서만 구현된 코드 -> feature 모듈화 분리
<ul>
<li>수많은 app 모듈 dependency를 끊어줘야했습니다.</li>
</ul>
</li>
<li>더이상 수정이 어려운 mvi 구조는 f/o 하고 mvvm 으로 전환하기로 하였습니다.</li>
<li>clean architecture 적용하기로 하였습니다.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>이번 프로젝트에서 제 주요 역할은 아래와 같았습니다.</p>
<ul>
<li>탭 추가에 따른 전체 레이아웃 구조 설계
<ul>
<li>구조 설계가 필요한 이유는, 미리보기 탭이 경우에 따라서 안보이기 때문입니다.</li>
<li>A/B Test Api 결과에 따라 신규or이전 UX로 보여야 합니다.</li>
</ul>
</li>
<li>회차목록 이벤트 구조 설계
<ul>
<li>회차목록엔 여러가지 이벤트 처리가 있습니다.
<ul>
<li>마지막 읽은 회차 포커싱</li>
<li>유료회차 접고/펼침</li>
<li>첫화보기 스낵바 버튼 노출</li>
</ul>
</li>
<li>MVI로 소비되던 구조를 MVVM에 맞게 재구성합니다.</li>
</ul>
</li>
<li>회차목록 에러케이스 처리 개선
<ul>
<li>에러케이스 처리에 대한 복잡도가 높았습니다.</li>
<li>불필요한 로직은 개선하고, 단순화 합니다.</li>
</ul>
</li>
</ul>
<p><strong>탭 추가에 따른 전체 레이아웃 구조 설계</strong></p>
<ul>
<li><strong>A/B 테스트 대상자</strong>에 따라 신UI or 구UI로 보여줘야 합니다.</li>
<li>고려했던 방향은 두가지였습니다.
<ul>
<li>1안 : 처음부터 TabLayout을 구성, ABT 결과에 따라서 visible 제어</li>
<li>2안 : 아예 별도의 Layout으로 구성</li>
</ul>
</li>
<li>저는 2안으로 의견을 냈고 2안으로 최종 결정되었습니다.
<ul>
<li>1안으로 갈 경우, ABT 결과에 따라 TabLayout에 대한 비노출 처리하는 처리가 필요합니다.
<ul>
<li>추후 새로운 탭이 하나더 추가될 수 있다고 했는데, 노출에 대한 분기가 생기기 쉽습니다.</li>
</ul>
</li>
<li>2안으로 할 경우, 미리보기, 회차목록 화면을 각 Fragment로 관리만 해주면 됩니다.
<ul>
<li>ABT 기존: EpisodeListFragment(재사용)</li>
<li>ABT 신규: ViewPagerFragment (신규)
<ul>
<li>PreviewFragment (신규)</li>
<li>EpisodeListFragment(재사용)</li>
</ul>
</li>
</ul>
</li>
<li>2안으로 가려면 EpisodeList에서 Activity와 의존성 걷어내야 하는 것이 작업이 컸지만,
장기적으로 보았을 땐 관리가 편한 구조가 됨에 팀원들도 공감하였습니다.</li>
</ul>
</li>
</ul>
<p><img src="/portfolio/projects/episode-list-preview-tab/layout.png" alt="레이아웃"></p>
<p>레이아웃의 구조는 위처럼 잡았습니다.</p>
<ul>
<li>ABT 결과에 따라, FragmentContainer에 적절한 Fragment를 넣어줍니다.</li>
<li>회차목록 Fragment은 재사용 합니다.</li>
</ul>
<p><strong>회차목록 이벤트 소비 구조 설계</strong></p>
<ul>
<li>스펙이 복잡하고, 히스토리가 많아서 양앱간 스펙을 처음부터 맞춰봐야 했습니다.
<ul>
<li>마지막 읽음 회차 포커싱은 진입시 읽음회차 스냅샷 기반으로 할 것인가, 동기화 기준으로 할 것인가?</li>
<li>유료회차 접고 펼침은 어떤 데이터로 어느 타이밍에 할 것인가?</li>
<li>첫화보기 스낵바 노출은 회차 진입시점인가? BG -> FG 때도 노출을 제어하는가?</li>
<li>읽음회차가 뒤늦게 동기화 될 수 있기에 이 데이터를 어떻게 처리할까?</li>
<li>탭은 어떤 데이터 기준으로 결정해야 하는가?</li>
<li>....</li>
</ul>
</li>
</ul>
<p><img src="/portfolio/projects/episode-list-preview-tab/events.png" alt="이벤트"></p>
<ul>
<li>저는 이렇게 양앱간 논의해야 할 것이 생길 땐 그림으로 정리를 합니다.
<ul>
<li>이 과정이 있으면 QA때 추가적인 커뮤니케이션 비용을 아낄 수 있습니다.</li>
</ul>
</li>
<li>AOS의 전체적인 이벤트 처리 구조 및 어떤 타이밍에 어떤 데이터를 소비해야하는지를 정리하고 IOS와 스펙을 맞추었습니다.</li>
<li>예상대로 다른 부분이 많았고, 기획과 논의하여 대부분의 스펙을 정리할 수 있었습니다.</li>
</ul>
<p><strong>회차목록 에러케이스 처리 개선</strong></p>
<ul>
<li>히스토리가 복잡해서.. 직접 하나씩 따라가며 구조를 그려본 모습입니다.
<em>(구체적인 코드는 업무 내용상 공유 못드리는 점 양해부탁드립니다.)</em></li>
</ul>
<p><img src="/portfolio/projects/episode-list-preview-tab/complex.png" alt="복잡도"></p>
<p>한번 정리하고, 로직을 확인하다보니 개선할 부분이 보였습니다.</p>
<ul>
<li>에러를 처리하는 곳이 한 곳에 집중되어 있다보니깐, 이벤트를 따라가기 어려웠습니다.</li>
<li>불필요한 로직, 아예 분리할 수 있는 로직 등 정리가 필요했습니다.</li>
</ul>
<p>로직을 정리하다 보니 에러는 크게 3가지로 분류할 수 있었습니다.</p>
<ul>
<li>회차목록 동기화 에러</li>
<li>결제관련 에러</li>
<li>BM동기화 에러</li>
</ul>
<p>3가지 에러 로직에서도 서로를 호출하면서 복잡한 의존성이 생겼습니다.</p>
<p><strong>개선 후</strong></p>
<ul>
<li>서로 의존하지 않아도 되는 부분은 제거하고, 각 플로우도 한번 더 정리하였습니다.</li>
<li>로직 내에선 다른 에러 핸들링 로직을 타지 않게 되었습니다.</li>
</ul>
<p><img src="/portfolio/projects/episode-list-preview-tab/improved.png" alt="개선후"></p>
<p><strong>총평</strong></p>
<ul>
<li>다들 하나 같이 이번에 개선 안했으면 큰일날 뻔했겠다 얘기했습니다.</li>
<li>이렇게 시간들여 개선하면 좋은 점은 <a href="https://bumbums.imweb.me/18/?q=YToxOntzOjEyOiJrZXl3b3JkX3R5cGUiO3M6MzoiYWxsIjt9&#x26;bmode=view&#x26;idx=148692066&#x26;t=board">이후 기능 추가시에도</a> 공수를 많이 아껴준다는 것입니다.</li>
<li>레이아웃의 구조, 이벤트 처리, 모듈화, 노후 로직 개선 등 여러가지 배울 수 있는 과제였습니다.</li>
</ul>
<p><strong>아쉬운 점은?</strong></p>
<ul>
<li>개발 당시는 팀내 UseCase를 막 도입한 시기였습니다.
<ul>
<li>그리고 UseCase는 Repository의 결과만 전달해주는 데이터 상하차 역할이었습니다.</li>
<li>대부분의 비즈니스 로직이 전부 ViewModel에 들어가다보니, ViewModel 쪽 코드가 복잡해졌습니다.</li>
<li>지금 생각하면 Usecase에서 비즈니스 로직을 처리할 수 있었습니다.</li>
</ul>
</li>
<li>공통적인 비즈니스 로직은 Domain쪽에서 처리하고, ViewModel에는 최대한 Ui와 관련된 로직만 두는 것이 어떨까 생각이 듭니다.</li>
<li>다음에 개선할 기회가 있으면 좋겠습니다!</li>
</ul></article>
</div>
</body>
</html>