<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="/portfolio/_next/static/css/28e8d7af1365f61e.css" data-precedence="next"/>
  <link rel="stylesheet" href="/portfolio/_next/static/css/028b338515cb152f.css" data-precedence="next"/>
  <link rel="icon" href="/portfolio/favicon.ico" type="image/x-icon" sizes="16x16"/>
</head>
<body class="__variable_6d341e __variable_6d341e antialiased">
<header class="sticky top-0 z-50 backdrop-blur bg-background/70 border-b border-foreground/10"><div class="max-w-6xl mx-auto px-4 sm:px-6 h-14 flex items-center justify-between"><a class="text-sm font-semibold tracking-tight" href="/portfolio/">한승범</a><nav class="flex items-center gap-3"><a href="https://www.linkedin.com/in/%EC%8A%B9%EB%B2%94-%ED%95%9C-54984b168" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-foreground/15 hover:bg-foreground/5 text-sm"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1 4.98 2.12 4.98 3.5zM.5 8h4V24h-4V8zm7 0h3.8v2.2h.06c.53-1 1.83-2.2 3.76-2.2 4.02 0 4.76 2.64 4.76 6.07V24h-4v-7.1c0-1.69-.03-3.86-2.35-3.86-2.35 0-2.71 1.83-2.71 3.73V24h-4V8z"></path></svg>LinkedIn</a><a href="mailto:beoms6000@gmail.com" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-foreground/15 hover:bg-foreground/5 text-sm"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 13.065 1.5 6h21L12 13.065zM12 15 1.5 8v10h21V8L12 15z"></path></svg>Email</a></nav></div></header>
<div class="max-w-5xl mx-auto px-6 py-10 space-y-8">
  <header class="space-y-3">
    <h1 class="text-2xl sm:text-4xl font-bold tracking-tight">베스트도전탭 컴포즈 전환 작업</h1>
  </header>
  <article class="markdown-body max-w-[68ch] mx-auto text-foreground/90"><p>웹툰앱은 조금씩 Compose로 전환하고 있습니다.
이번엔 아래 <strong>베스트도전 홈 화면</strong>을 컴포즈로 전환하는 과제입니다.</p>
<p><img src="/portfolio/projects/best-challenge-compose/home.png" alt="베스트도전 홈"></p>
<p>이전에 설정화면 일부를 Compose로 맛보기로 전환해본 경험은 있지만,
이번처럼 큰 feature는 처음이라 기대도 되면서 걱정도 되었습니다.
그래서 이번 프로젝트를 하면서 아래 내용은 적어도 한번은 다시 보자는 마음으로 하고 있습니다.</p>
<ul>
<li><a href="https://developer.android.com/develop/ui/compose/documentation">android developer compose document</a></li>
<li><a href="https://developer.android.com/develop/ui/compose/performance/bestpractices">android developer compose best practice</a></li>
<li><a href="https://www.youtube.com/playlist?list=PLWz5rJ2EKKc-CG9riunK996aI6cRhXFDC">Android Mad SKills - compose</a></li>
<li><a href="https://github.com/android/nowinandroid/tree/main">now in android</a></li>
</ul>
<p>제가 맡은 부분은 홈화면 중에서도 목록 페이징 부분입니다.</p>
<ul>
<li>페이징2를 사용하고 있어서 3로 마이그레이션 필요합니다.</li>
<li>paging을 ui로 가져오는 구조가 복잡하게 구현되어 있어 같이 정리가 필요합니다.</li>
<li>아이템 삭제/수정 없이 로드만 하면되어 큰 이슈는 없을 것으로 보입니다.</li>
</ul>
<p><strong>중간공유 #1</strong></p>
<ul>
<li>컴포즈를 사용하면 할수록 편하다는 생각이 들었습니다.
<ul>
<li>PagingAdapter, ItemDecoration, LoadStateAdapter, ViewHolder 구현 없이 Composable로 처리할 수 있어 좋았습니다.</li>
<li>특히 Preview로 바로 보면서 개발할 수 있는게 편했습니다.</li>
</ul>
</li>
<li>아직까지는 이슈 없이 연동중이며 페이징3 마이그레이션도 잘 마무리 되었습니다.</li>
</ul>
<p><strong>중간공유 #2</strong></p>
<ul>
<li>LazyColumn에서 스크롤이 예상대로 되지 않는 이슈가 있어 살펴보고 있습니다.
<ul>
<li>베도 홈은 placeholder를 사용하지 않는 페이징 방식 입니다.</li>
<li>스크롤을 하면 로딩뷰가 뜨고 아이템이 추가되면 다시 스크롤 가능한 형태입니다.</li>
<li>RecyclerView에선 스크롤을 빠르게 하면 아이템이 추가되고 이어서 밑으로 스크롤이 가능했는데,
LazyColumn에서는 아이템이 추가되어도 스크롤이 잠긴 듯 내려가지 않았습니다.</li>
</ul>
</li>
<li>이슈의 원인을 파악하기 위해 여러 삽질을 했습니다.
<ul>
<li>잘못 짠 것은 아닐까 싶어 여러 best-practice를 참고했으나 올바르게 구현했습니다.</li>
<li>뷰페이저에서 분리해 단독 뷰로 분리해도 동일했습니다.</li>
<li>로딩 뷰가 스크롤에 주는 영향일까 싶어 제거해보았으나 동일했습니다.</li>
</ul>
</li>
</ul>
<p><strong>샘플앱 개발비교 (RecyclerView | ComposeView)</strong></p>
<p><img src="/portfolio/projects/best-challenge-compose/compare.png" alt="샘플 비교"></p>
<ul>
<li>동일한 PagingSource, 뷰, 아이템 구성입니다.</li>
<li>동일한 환경이여도 이슈는 재현되었습니다.
<ul>
<li>RecyclerView: 아이템이 추가됨에 따라 스크롤이 내려감</li>
<li>ComposeView: 뭔가에 걸린듯 탁 스크롤이 멈추고 내려가지 못함
(참고로 빠르게 스크롤이 유지되는 동안만이며, 멈추면 다시 잘됩니다.)</li>
</ul>
</li>
<li><code>enablePlaceHolder = true</code>로 변경 후 placeholder를 구현하면 스크롤은 가능합니다.
<ul>
<li>다만 이 경우, <code>jumpthreshold</code> 를 구현해줘야 하며, AS-IS대비 API 호출량이 증가할 수 있습니다.</li>
<li>양앱 스펙이 달라지고 디자인 가이드도 추가로 받아야 합니다.</li>
<li>AS-IS 형태로 compose 전환하는게 과제라 우선 원인을 파악하고 있습니다.</li>
</ul>
</li>
<li>Google Issue Tracker에 제보 후 답변 대기 중입니다.
<ul>
<li><a href="https://issuetracker.google.com/issues/397562592">https://issuetracker.google.com/issues/397562592</a></li>
</ul>
</li>
</ul>
<p><strong>중간공유 #3</strong></p>
<ul>
<li>베도홈 컴포즈 전환은 거의다 마무리 되었습니다.</li>
<li>코드 최적화 및 성능 테스트를 진행중입니다.
<ul>
<li>Android Studio > recomposition debug > 화면 변화에 따라 많이 발생하는 부분 개선
<ul>
<li>padding값의 인자가 동적으로 바뀌는 부분 offset 기준으로 개선 의견
<ul>
<li>참고 : <a href="https://developer.android.com/develop/ui/compose/phases#optimizing-state-reads">https://developer.android.com/develop/ui/compose/phases#optimizing-state-reads</a></li>
</ul>
</li>
<li>스크롤 위치 값을 인자로 넘겨주는 부분, 사용하는 부분만 recomposition 되도록 개선 의견
<ul>
<li>참고 : <a href="https://developer.android.com/develop/ui/compose/performance/bestpractices#defer-reads">https://developer.android.com/develop/ui/compose/performance/bestpractices#defer-reads</a></li>
</ul>
</li>
<li><code>combinedLoadStates</code>로 로딩바에서 자주 변경될 수 있는 부분 <code>derivedStateOf</code>로 개선
<ul>
<li>참고 : <a href="https://developer.android.com/develop/ui/compose/performance/bestpractices#use-derivedstateof">https://developer.android.com/develop/ui/compose/performance/bestpractices#use-derivedstateof</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>스크롤 이슈는 확인사항이 있을 때마다 공유드리고 있습니다.
<ul>
<li>scrollState 제어(stopScroll, animateScroll, scrollToPosition) 테스트 결과</li>
<li>OS 별로 이슈 재현여부 공유
<ul>
<li>OS 11 이전엔 재현이 되지 않고, OS 12에서만 재현되는 것을 공유드렸습니다.</li>
<li>스크롤 관련하여 OS 12에서 참고할만한 변화는 <a href="https://developer.android.com/develop/ui/views/touch-and-input/gestures/scroll?hl=en">Overscroll Effect</a>가 있어 함께 공유드렸습니다..</li>
</ul>
</li>
<li>구글 이슈로 확인되어도 배포되는데 시간이 걸리니 바로 적용은 어려울 것으로 보입니다.
<ul>
<li>팀내 compose 적용하는 부서에 내용 전파 및 issueTracker 내용 공유드렸습니다.</li>
<li>기획에서는 수정을 희망하여, 가능한 수정 방안이 있을지 조금 더 검토해볼 예정입니다.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>중간공유 #4</strong></p>
<p><img src="/portfolio/projects/best-challenge-compose/issue-reply.png" alt="구글 이슈 답변"></p>
<ul>
<li>구글에서 답변이 왔습니다.
<ul>
<li>OverscrollEffect 문제로 보인다고 1.8-beta에서 테스트를 요청주셨습니다.</li>
<li>테스트하니 1.8-beta02에서 이슈가 해결되었습니다.  OverscrollEffect 이슈가 맞았습니다.</li>
</ul>
</li>
<li>beta 버전을 프로덕션에 적용하기는 리스크가 있어 아래 두가지를 추가로 여쭤보았습니다.
<ul>
<li>1.7 버전에서 OverscrollEffect disable 가능한지?</li>
<li>1.8 버전 stable 일정?</li>
</ul>
</li>
<li>다행히도 이전 버전에서도 이슈를 해결할 수 있는 방법이 있었습니다.</li>
</ul>
<p><img src="/portfolio/projects/best-challenge-compose/overscroll-solution.png" alt="해결 방법"></p>
<ul>
<li>beta가 나오면 release도 금방 나올 것으로 공유 받았습니다.</li>
<li>기획과도1.8 stable 전까지 OverscrollEffect를 끄는 쪽으로 협의되어 해당 이슈는 잘 마무리 되었습니다.</li>
</ul></article>
</div>
</body>
</html>